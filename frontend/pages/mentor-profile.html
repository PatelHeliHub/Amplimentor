<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mentor Profile - Amplimentor</title>
  <link rel="stylesheet" href="/style.css?v=1.3">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="/mentor-dashboard.html" class="nav-brand">Amplimentor</a>
      <ul class="nav-menu">
        <li><a href="/mentor/profile">Profile</a></li>
        <li><a href="/my-students.html">My Students</a></li>
        <li><a href="/chat.html">Chat</a></li>
        <li><a href="/chat-history.html">Chat History</a></li>
        <li><a href="/sessions.html">Sessions</a></li>
        <li><a href="/mentor-pricing">Pricing</a></li>
        <li class="notification-item">
            <a href="#" id="notificationLink"><i class="fas fa-bell"></i><span class="notification-count" id="notificationCount"></span></a>
            <div class="notification-dropdown" id="notificationDropdown"></div>
        </li>
        <li><a href="/logout" class="logout-btn">Logout</a></li>
      </ul>
    </div>
  </nav>
  <div class="container">
    <main>
      <section class="hero">
        <h1>My Mentor Profile</h1>
        <p class="hero-sub">Manage your professional information and mentoring preferences</p>
      </section>
      
      <section class="profile" id="mentor-profile-section">
        <div id="profile-view">
          <div class="profile-info">
            <div style="text-align: center;">
              <img id="mentorPhoto" src="/default-avatar.svg" style="border-radius: 50%; width: 120px; height: 120px; object-fit: cover; border: 4px solid #0077c2;" onerror="this.onerror=null;this.src='/default-avatar.svg'">
              <h2 id="mentorName">Mentor Name</h2>
              <p><strong id="company"></strong></p>
            </div>
            <div>
              <p><strong>Email:</strong> <span id="mentorEmail"></span></p>
              <p><strong>Role:</strong> <span id="mentorRole"></span></p>
              <p><strong>Experience:</strong> <span id="experience"></span></p>
              <p><strong>Phone:</strong> <span id="phoneNumber"></span></p>
              <p><strong>Location:</strong> <span id="location"></span></p>
            </div>
          </div>
          <div class="profile-section">
            <h3>About Me</h3>
            <p id="bio"></p>
          </div>
          <div class="profile-section">
            <h3>Professional Links</h3>
            <p><strong>LinkedIn:</strong> <a id="linkedIn" href="#" target="_blank"></a></p>
            <p><strong>GitHub:</strong> <a id="github" href="#" target="_blank"></a></p>
            <p><strong>Portfolio:</strong> <a id="portfolio" href="#" target="_blank"></a></p>
          </div>
          <div class="profile-section">
            <h3>Expertise & Skills</h3>
            <p><strong>Areas of Expertise:</strong> <span id="expertiseAreas"></span></p>
            <p><strong>Technical Skills:</strong> <span id="technicalSkills"></span></p>
            <p><strong>Industry:</strong> <span id="industry"></span></p>
          </div>
          <div class="profile-section">
            <h3>Mentoring Preferences</h3>
            <p><strong>Mentoring Style:</strong> <span id="mentoringStyle"></span></p>
            <p><strong>Preferred Meeting Frequency:</strong> <span id="meetingFrequency"></span></p>
            <p><strong>Communication Preference:</strong> <span id="communicationPreference"></span></p>
            <p><strong>Availability:</strong> <span id="availability"></span></p>
            <p><strong>Max Students:</strong> <span id="maxStudents"></span></p>
          </div>
          <div class="profile-section">
            <h3>Education & Certifications</h3>
            <p><strong>Education:</strong> <span id="education"></span></p>
            <p><strong>Certifications:</strong> <span id="certifications"></span></p>
          </div>
          <div class="profile-actions">
            <button id="editProfileBtn" class="cta-btn">Edit Profile</button>
          </div>
        </div>

        <div id="profile-edit" style="display: none;">
          <h3>Edit Your Profile</h3>
          <div class="info-grid">
            <div class="info-item">
              <label for="edit-name">Full Name</label>
              <input type="text" id="edit-name" class="edit-input">
            </div>
            <div class="info-item">
              <label for="edit-company">Company / Organization</label>
              <input type="text" id="edit-company" class="edit-input">
            </div>
            <div class="info-item">
              <label for="edit-role">Job Title / Role</label>
              <input type="text" id="edit-role" class="edit-input">
            </div>
            <div class="info-item">
              <label for="edit-experience">Years of Experience</label>
              <select id="edit-experience" class="edit-input">
                <option value="">Select...</option>
                <option value="0-2 years">0-2 years</option>
                <option value="3-5 years">3-5 years</option>
                <option value="6-10 years">6-10 years</option>
                <option value="10+ years">10+ years</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-phone">Phone Number</label>
              <input type="tel" id="edit-phone" class="edit-input">
            </div>
            <div class="info-item">
              <label for="edit-location">Location</label>
              <input type="text" id="edit-location" class="edit-input" placeholder="City, Country">
            </div>
            <div class="info-item">
              <label for="edit-bio">About Me</label>
              <textarea id="edit-bio" class="edit-input" placeholder="Tell us about your background and mentoring approach..."></textarea>
            </div>
            <div class="info-item">
              <label for="edit-linkedin">LinkedIn Profile URL</label>
              <input type="url" id="edit-linkedin" class="edit-input" placeholder="https://linkedin.com/in/your-profile">
            </div>
            <div class="info-item">
              <label for="edit-github">GitHub Profile URL</label>
              <input type="url" id="edit-github" class="edit-input" placeholder="https://github.com/your-username">
            </div>
            <div class="info-item">
              <label for="edit-portfolio">Portfolio URL</label>
              <input type="url" id="edit-portfolio" class="edit-input" placeholder="https://your-portfolio.com">
            </div>
            <div class="info-item">
              <label for="edit-expertiseAreas">Areas of Expertise (comma-separated)</label>
              <textarea id="edit-expertiseAreas" class="edit-input" placeholder="e.g., Web Development, Data Science, UI/UX"></textarea>
            </div>
            <div class="info-item">
              <label for="edit-technicalSkills">Technical Skills (comma-separated)</label>
              <textarea id="edit-technicalSkills" class="edit-input" placeholder="e.g., JavaScript, Python, React, Node.js"></textarea>
            </div>
            <div class="info-item">
              <label for="edit-industry">Industry</label>
              <select id="edit-industry" class="edit-input">
                <option value="">Select...</option>
                <option value="Technology">Technology</option>
                <option value="Healthcare">Healthcare</option>
                <option value="Finance">Finance</option>
                <option value="Education">Education</option>
                <option value="Marketing">Marketing</option>
                <option value="Design">Design</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-mentoringStyle">Mentoring Style</label>
              <select id="edit-mentoringStyle" class="edit-input">
                <option value="">Select...</option>
                <option value="Hands-on">Hands-on</option>
                <option value="Guided">Guided</option>
                <option value="Consultative">Consultative</option>
                <option value="Collaborative">Collaborative</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-meetingFrequency">Preferred Meeting Frequency</label>
              <select id="edit-meetingFrequency" class="edit-input">
                <option value="">Select...</option>
                <option value="Weekly">Weekly</option>
                <option value="Bi-weekly">Bi-weekly</option>
                <option value="Monthly">Monthly</option>
                <option value="As needed">As needed</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-communicationPreference">Preferred Communication</label>
              <select id="edit-communicationPreference" class="edit-input">
                <option value="">Select...</option>
                <option value="Video Call">Video Call</option>
                <option value="Chat">Chat</option>
                <option value="Email">Email</option>
                <option value="Phone">Phone</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-availability">Availability</label>
              <select id="edit-availability" class="edit-input">
                <option value="">Select...</option>
                <option value="Weekdays">Weekdays</option>
                <option value="Weekends">Weekends</option>
                <option value="Evenings">Evenings</option>
                <option value="Flexible">Flexible</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-maxStudents">Maximum Number of Students</label>
              <select id="edit-maxStudents" class="edit-input">
                <option value="">Select...</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
                <option value="Unlimited">Unlimited</option>
              </select>
            </div>
            <div class="info-item">
              <label for="edit-education">Education</label>
              <textarea id="edit-education" class="edit-input" placeholder="e.g., Bachelor's in Computer Science, University of XYZ"></textarea>
            </div>
            <div class="info-item">
              <label for="edit-certifications">Certifications (comma-separated)</label>
              <textarea id="edit-certifications" class="edit-input" placeholder="e.g., AWS Certified Developer, Google Cloud Professional"></textarea>
            </div>
            <div class="info-item">
              <label for="edit-photo">Change Profile Photo</label>
              <div class="photo-upload-container">
                  <input type="file" id="edit-photo" class="edit-input" accept="image/*">
                  <div class="photo-preview" id="photo-preview" style="display: none;">
                      <img id="preview-image" src="" alt="Preview" style="max-width: 150px; max-height: 150px; border-radius: 50%; margin-top: 10px;">
                      <button type="button" id="remove-photo" class="remove-photo-btn" style="margin-top: 10px; padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">Remove Photo</button>
                  </div>
                  <div class="upload-loading" id="upload-loading" style="display: none; text-align: center; margin-top: 10px;">
                      <div class="spinner" style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #0077c2; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                      <span style="margin-left: 10px; color: #0077c2;">Uploading photo...</span>
                  </div>
                  <div class="upload-info" style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                      Supported formats: JPG, PNG, GIF (max 5MB)
                  </div>
              </div>
            </div>
          </div>
          <div class="profile-actions">
            <button id="saveProfileBtn" class="cta-btn">Save Changes</button>
            <button id="cancelEditBtn" class="cta-btn" style="background: #6c757d;">Cancel</button>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <p>&copy; 2025 Amplimentor. All rights reserved.</p>
    </footer>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const viewMode = document.getElementById('profile-view');
      const editMode = document.getElementById('profile-edit');
      
      function populateProfileData(mentor) {
        // Helper function to set text content
        const setText = (id, text) => document.getElementById(id).textContent = text || 'N/A';
        // Helper function to set href
        const setLink = (id, url) => {
          const el = document.getElementById(id);
          if (url) {
            el.href = url;
            el.textContent = url;
            el.style.display = 'inline';
          } else {
            el.style.display = 'none';
            el.textContent = '';
          }
        };

        setText('mentorName', mentor.name);
        setText('company', mentor.company);
        setText('mentorEmail', mentor.email);
        setText('mentorRole', mentor.role);
        setText('experience', mentor.experience);
        setText('phoneNumber', mentor.phoneNumber);
        setText('location', mentor.location);
        setText('bio', mentor.bio);
        setLink('linkedIn', mentor.linkedIn);
        setLink('github', mentor.github);
        setLink('portfolio', mentor.portfolio);
        setText('expertiseAreas', (mentor.expertiseAreas && mentor.expertiseAreas.length) ? mentor.expertiseAreas.join(', ') : '');
        setText('technicalSkills', (mentor.technicalSkills && mentor.technicalSkills.length) ? mentor.technicalSkills.join(', ') : '');
        setText('industry', mentor.industry);
        setText('mentoringStyle', mentor.mentoringStyle);
        setText('meetingFrequency', mentor.meetingFrequency);
        setText('communicationPreference', mentor.communicationPreference);
        setText('availability', mentor.availability);
        setText('maxStudents', mentor.maxStudents);
        setText('education', mentor.education);
        setText('certifications', (mentor.certifications && mentor.certifications.length) ? mentor.certifications.join(', ') : '');
        
        const mentorPhoto = document.getElementById('mentorPhoto');
        if (mentor.photo) {
          mentorPhoto.src = '/uploads/' + mentor.photo;
        } else {
          mentorPhoto.src = '/default-avatar.svg';
        }

        // Populate edit form
        document.getElementById('edit-name').value = mentor.name || '';
        document.getElementById('edit-company').value = mentor.company || '';
        document.getElementById('edit-role').value = mentor.role || '';
        document.getElementById('edit-experience').value = mentor.experience || '';
        document.getElementById('edit-phone').value = mentor.phoneNumber || '';
        document.getElementById('edit-location').value = mentor.location || '';
        document.getElementById('edit-bio').value = mentor.bio || '';
        document.getElementById('edit-linkedin').value = mentor.linkedIn || '';
        document.getElementById('edit-github').value = mentor.github || '';
        document.getElementById('edit-portfolio').value = mentor.portfolio || '';
        document.getElementById('edit-expertiseAreas').value = (mentor.expertiseAreas && mentor.expertiseAreas.length) ? mentor.expertiseAreas.join(', ') : '';
        document.getElementById('edit-technicalSkills').value = (mentor.technicalSkills && mentor.technicalSkills.length) ? mentor.technicalSkills.join(', ') : '';
        document.getElementById('edit-industry').value = mentor.industry || '';
        document.getElementById('edit-mentoringStyle').value = mentor.mentoringStyle || '';
        document.getElementById('edit-meetingFrequency').value = mentor.meetingFrequency || '';
        document.getElementById('edit-communicationPreference').value = mentor.communicationPreference || '';
        document.getElementById('edit-availability').value = mentor.availability || '';
        document.getElementById('edit-maxStudents').value = mentor.maxStudents || '';
        document.getElementById('edit-education').value = mentor.education || '';
        document.getElementById('edit-certifications').value = (mentor.certifications && mentor.certifications.length) ? mentor.certifications.join(', ') : '';
      }

      function fetchMentorProfile() {
        fetch('/api/mentor/profile', { credentials: 'include' })
          .then(res => res.ok ? res.json() : Promise.reject('Failed to load profile'))
          .then(populateProfileData)
          .catch(console.error);
      }

      document.getElementById('editProfileBtn').addEventListener('click', () => {
        viewMode.style.display = 'none';
        editMode.style.display = 'block';
      });

      document.getElementById('cancelEditBtn').addEventListener('click', () => {
        editMode.style.display = 'none';
        viewMode.style.display = 'block';
      });

      document.getElementById('saveProfileBtn').addEventListener('click', () => {
        const updatedData = {
          name: document.getElementById('edit-name').value,
          company: document.getElementById('edit-company').value,
          role: document.getElementById('edit-role').value,
          experience: document.getElementById('edit-experience').value,
          phoneNumber: document.getElementById('edit-phone').value,
          location: document.getElementById('edit-location').value,
          bio: document.getElementById('edit-bio').value,
          linkedIn: document.getElementById('edit-linkedin').value,
          github: document.getElementById('edit-github').value,
          portfolio: document.getElementById('edit-portfolio').value,
          expertiseAreas: document.getElementById('edit-expertiseAreas').value.split(',').map(s => s.trim()).filter(Boolean),
          technicalSkills: document.getElementById('edit-technicalSkills').value.split(',').map(s => s.trim()).filter(Boolean),
          industry: document.getElementById('edit-industry').value,
          mentoringStyle: document.getElementById('edit-mentoringStyle').value,
          meetingFrequency: document.getElementById('edit-meetingFrequency').value,
          communicationPreference: document.getElementById('edit-communicationPreference').value,
          availability: document.getElementById('edit-availability').value,
          maxStudents: document.getElementById('edit-maxStudents').value,
          education: document.getElementById('edit-education').value,
          certifications: document.getElementById('edit-certifications').value.split(',').map(s => s.trim()).filter(Boolean),
        };

        const photoFile = document.getElementById('edit-photo').files[0];

        const saveProfileData = () => {
          fetch('/api/mentor/profile', {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify(updatedData),
          })
          .then(res => res.ok ? res.json() : Promise.reject('Failed to save profile data'))
          .then(() => {
            editMode.style.display = 'none';
            viewMode.style.display = 'block';
            fetchMentorProfile(); // Refresh data
            // Clear photo preview
            document.getElementById('photo-preview').style.display = 'none';
            document.getElementById('edit-photo').value = '';
          })
          .catch(error => {
            console.error('Error saving profile:', error);
            alert('Failed to save profile. Please try again.');
          });
        };

        if (photoFile) {
          // Validate file size
          if (photoFile.size > 5 * 1024 * 1024) {
            alert('File size too large. Maximum size is 5MB.');
            return;
          }

          // Validate file type
          if (!photoFile.type.startsWith('image/')) {
            alert('Please select an image file.');
            return;
          }

          // Show loading indicator
          document.getElementById('upload-loading').style.display = 'block';
          document.getElementById('saveProfileBtn').disabled = true;
          document.getElementById('saveProfileBtn').textContent = 'Uploading...';

          const formData = new FormData();
          formData.append('photo', photoFile);
          fetch('/api/mentor/upload-photo', {
            method: 'POST',
            credentials: 'include',
            body: formData,
          })
          .then(res => {
            if (!res.ok) {
              return res.json().then(err => Promise.reject(err.message || 'Photo upload failed'));
            }
            return res.json();
          })
          .then(data => {
            console.log('Photo uploaded successfully:', data);
            // Hide loading indicator
            document.getElementById('upload-loading').style.display = 'none';
            document.getElementById('saveProfileBtn').disabled = false;
            document.getElementById('saveProfileBtn').textContent = 'Save Changes';
            saveProfileData();
          })
          .catch(error => {
            console.error('Photo upload error:', error);
            // Hide loading indicator
            document.getElementById('upload-loading').style.display = 'none';
            document.getElementById('saveProfileBtn').disabled = false;
            document.getElementById('saveProfileBtn').textContent = 'Save Changes';
            alert('Failed to upload photo: ' + error);
          });
        } else {
          saveProfileData();
        }
      });

      // Photo preview functionality
      document.getElementById('edit-photo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        const preview = document.getElementById('photo-preview');
        const previewImage = document.getElementById('preview-image');
        
        if (file) {
          // Validate file size
          if (file.size > 5 * 1024 * 1024) {
            alert('File size too large. Maximum size is 5MB.');
            this.value = '';
            preview.style.display = 'none';
            return;
          }

          // Validate file type
          if (!file.type.startsWith('image/')) {
            alert('Please select an image file.');
            this.value = '';
            preview.style.display = 'none';
            return;
          }

          const reader = new FileReader();
          reader.onload = function(e) {
            previewImage.src = e.target.result;
            preview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        } else {
          preview.style.display = 'none';
        }
      });

      // Remove photo functionality
      document.getElementById('remove-photo').addEventListener('click', function() {
        document.getElementById('edit-photo').value = '';
        document.getElementById('photo-preview').style.display = 'none';
      });

      fetchMentorProfile();
    });
  </script>
</body>
</html> 